### 研究计划

**题目**：基于需求驱动与检索增强生成（RAG）的Spring Boot多智能体代码生成框架  

---

#### **研究背景**

Spring Boot因其模块化设计和注解驱动的开发模式被广泛使用，但在复杂需求下，传统代码生成工具（如Spring Initializr、MyBatis Generator）难以动态适配仓库层级的上下文依赖（如跨文件类引用、依赖注入关系）。现有大模型（如Codex、CodeLlama）虽能生成单文件代码，但在多文件协作生成、长上下文检索及噪声过滤上存在显著不足。结合检索增强生成（RAG）与多智能体协作，可精准提取代码库上下文，通过闭环测试反馈迭代优化生成结果，提升代码可用性。  

---

#### **研究内容**

1. **需求驱动的上下文建模**
   - **函数级语义依赖图**：基于AST解析Spring Boot代码，提取函数输入/输出、注解（如`@Autowired`）及调用关系，构建函数节点图。  
   - **文件级依赖图**：分析文件间的依赖注入（如Controller调用Service）、继承关系及包结构，生成仓库级依赖图谱（参考IntelliJ IDEA的依赖分析工具）。  
   - **动态上下文检索**：集成LightRAG框架，结合语义相似度（Sentence-BERT）和图遍历算法（如BFS），按需检索相关代码片段。  

2. **多智能体协作生成**  
   - **智能体分工**：  
     - **需求解析器**：将自然语言需求拆解为Spring Boot组件（如“新增用户登录接口” → Controller/Service/Entity）。  
     - **代码生成器**：基于CodeLlama-34B，结合检索到的上下文生成代码（支持多轮迭代）。  
     - **测试生成器**：根据代码逻辑自动生成JUnit测试用例（使用EvoSuite框架）。  
     - **反思器**：分析测试失败原因（如依赖缺失、逻辑错误），生成修正需求（如“UserService未注入”）。  

3. **噪声过滤与自监督学习**  
   - **选择性RAG机制**：训练二分类模型（基于BERT），评估检索上下文的有效性（输入：代码片段+查询，输出：相关性得分），过滤低分片段。  
   - **增量更新**：利用LightRAG的图索引结构，仅更新变动文件的嵌入向量（FAISS索引），降低计算开销。  

4. **测试驱动的闭环验证**  
   - **TestBench构建**：从开源Spring Boot项目（如Spring PetClinic）中提取典型需求场景（如CRUD、权限管理）作为基准测试集。  
   - **回归测试**：通过CI/CD工具（GitHub Actions）自动执行测试，反馈错误类型（语法错误、依赖冲突）至反思器。  

---

#### **研究方案**

1. **数据准备与工具链搭建**
   - **代码数据库**：收集10个开源Spring Boot项目，使用TreeSitter解析代码，提取函数/文件元数据，存储为图数据库（Neo4j）。  
   - **RAG框架集成**：  
     - **索引构建**：使用LightRAG对代码片段生成嵌入（text-embedding-3-small），存储至FAISS向量库。  
     - **检索逻辑**：结合语义检索（Top-5相似片段）和图检索（依赖关系相邻节点）。  
   - **智能体开发**：基于LangChain框架实现多智能体协作流程，调用CodeLlama-34B（HuggingFace API）生成代码。  

2. **关键模块实现**  
   - **需求解析器**：  
     - 输入：“实现用户注册功能，需记录操作日志。”  
     - 输出：需修改`UserController.java`（新增`/register`接口）、`UserService.java`（业务逻辑）、`LogEntity.java`（日志实体类）。  
   - **自监督训练**：  
     - 正样本：检索后生成代码通过测试的上下文片段。  
     - 负样本：检索后生成代码失败的上下文片段。  
     - 训练目标：二分类模型AUC > 0.85。  

3. **实验设计**  
   - **基线对比**：  
     - 传统RAG（固定分块检索） vs LightRAG（图索引+动态检索）。  
     - 单智能体生成 vs 多智能体协作生成。  
   - **评估指标**：  
     - **功能正确性**：测试用例通过率。  
     - **上下文适配性**：生成代码中依赖注入的正确比例（如`@Autowired`是否匹配现有Bean）。  
     - **效率**：单次生成耗时（目标：<30秒）。  

---

#### **预期结果**

1. 实现一个轻量级Spring Boot代码生成框架，支持多文件协作生成与闭环测试反馈。  
2. 在TestBench中，生成代码的测试通过率较传统RAG提升30%以上（从50% → 80%）。  
3. 输出技术报告1份，开源框架核心模块（GitHub），提供API接口与Demo案例（如生成用户管理模块）。  
